# Сброс пароля root

## centos 7/fedora 29 (возможно rhel)

### Метод 1

В меню grub выбрать необходимое ядро, нажать клавишу **e**. В появившемся перечне команд найти строку начинающуюся с `linux 16`. В подстроке найти параметр `ro` и изменить на `rw init=/sysroot/bin/sh`. Этот параметр позволяет смонтировать ФС в режиме чтение-запись и запустить shell с root привилегиями в однопользовательском режиме. Для применения изменений нажать **ctrl + x**, что приведёт к загрузке в ОС. Далее необходимо сделать чрут в /sysroot.

```console
chroot /sysroot
```

Создаём новый пароль

```console
passwd root
```

Напоследок требуется выполнить команду, которая обновит параметры SELinux (сделает переразметку необходимых файлов).

```console
touch .autorelabel
systemctl reboot
```

После загрузки ждём обновления SELinux. Если всё прошло как следует, то увидим строку приглашения.

### Метод 2

В меню grub нажимаем **e** на выбранном ядре. В строке `linux /vmlinuz-` удаляем `rhgb quiet`, добавляем в конец `rd.break enforcing=0` и загружаемся в ОС (`ctrl+x`). Как и в предыдущем методе монтируем корень на чтение-запись `mount -o remount,rw /sysroot`, делаем `chroot /sysroot`. Изменяем пароль `passwd`. Если всё прошло хорошо, то получим
> all authentication tokens updated successfully

После чего отправляем в перезагрузку машину. После логинимся под рутом и выполняем команды для восстановления работы SELinux. Подробнее про relabling читать [тут](https://wiki.centos.org/HowTos/SELinux#head-0f6390ddacfab39ee973ed8018a32212c2a02199)

```console
restorecon -v /etc/shadow
setenforce 1
```

## Debian (и производные)

### Метод 1

В меню grub выбрать необходимое ядро, нажать **e**. В параметрах загрузки ядра параметру `linux /vmlinuz-` изменить `ro` на `rw` и добавить в конец строки `init=/bin/sh`. Ctrl+x для загрузки в ОС с применёнными параметреми. Далее следует корень перемонтировать на запись.

```console
mount -rw -o remount /
```

После этого запускаем 

```console
passwd root
```

изменяем пароль рута, после изменения перезагружаем машину и логинимся под рутом для проверки.

### Метод 2

Так же грузимся в ОС как и в методе 1, но вместо сброса пароля редактируем файлы `/etc/passwd` и `/etc/shadow`. В `/etc/passwd` удаляем всё после `root`, в `/etc/shadow` удаляем хэш между 2 и 3 символом `:`. Сохраняем изменения и перезагружаемся. Вообще это 2 разных способа, но я их объединил в 1.

Есть ещё методы сброса пароля при помощи livecd/rescue mode, но их отличие +/- незначительное от упомянутых выше. Принципиальная разница лишь в том, что после загрузки с LiveCD/rescue необходим в ручную смонтировать разделы в режиме чтения-записи. Дальнейшие действия: сделать chroot и задать новый пароль.

# Переименование VG

Внутри Vagrantfile подготовлен provision скрипт. Для активации требуется расскоментировать соответствующую строку.

# Добавление модуля в initrd

Внутри Vagrantfile подготовлен provision скрипт. Для активации требуется расскоментировать соответствующую строку.

Проверить на машине с GUI для VirtualBox.
